
---

# Task Controller and Task System – File Documentation

This document outlines the purpose and responsibilities of the core task system source files. These files collectively implement a **ROS 2 lifecycle-based task controller**, responsible for perception-driven navigation, waypoint generation, and mission sequencing.

---

## `task_component.cpp`

### Purpose

Implements the **base Task lifecycle node**, which acts as the foundation for all mission tasks.
This file defines the shared behavior, state management, and ROS interfaces used by all derived task components.

---

### Responsibilities

* Implements a `rclcpp_lifecycle::LifecycleNode`
* Manages task activation and execution state
* Handles parameter updates and validation
* Maintains shared task state (detections, waypoints, counters, flags)
* Provides common utilities used by specialized tasks

---

### Key Concepts

* **Lifecycle-aware task execution**

  * Uses `on_configure`, `on_activate`, `on_deactivate`, etc.
* **Detection-driven logic**

  * Consumes perception outputs (YOLOv8 detections)
* **Waypoint management**

  * Tracks when waypoints are generated and reached
* **Shared task flags**

  * `activated_`
  * `bboxes_updated_`
  * `wp_reached_`
  * Detection counters and waypoint indices

---

### Interactions

* Consumed by:

  * `task_controller_component.cpp`
  * Specific task implementations (e.g., maneuvering, speed, home)
* Uses:

  * `bbox_calculations` for vision reasoning
  * `task_lib` for geometry and navigation utilities
* Publishes:

  * Local or global waypoint messages
* Subscribes:

  * Detection arrays
  * Vehicle state / pose

---

### Role in System

This file defines the **abstract task behavior layer**.
All task-specific logic builds on top of this implementation.

---

## `task_controller_component.cpp`

### Purpose

Implements the **Task Controller**, responsible for **orchestrating task execution**, switching between tasks, and routing sensor and state data to the active task.

---

### Responsibilities

* Manages the currently active task
* Loads and instantiates task components
* Routes incoming data (detections, poses, states) to the active task
* Handles task transitions and completion logic
* Acts as the central coordinator for mission flow

---

### Key Concepts

* **Task arbitration**

  * Determines which task is active
* **Task switching**

  * Activates and deactivates tasks using lifecycle transitions
* **Central data routing**

  * Ensures only the active task processes inputs
* **Mission sequencing**

  * Advances tasks based on completion criteria

---

### Interactions

* Owns or manages:

  * Multiple `Task` lifecycle nodes
* Subscribes:

  * YOLOv8 detection topics
  * MAVROS state
  * Local and global pose updates
* Publishes:

  * Waypoints generated by active task
* Calls:

  * Task lifecycle transitions

---

### Role in System

This file is the **mission executive**.
It does not implement task logic itself, but controls *when* and *which* task runs.

---

## `task_controller_composition.cpp`

### Purpose

Defines the **ROS 2 component composition entry point** for the task controller system.

This file enables the task controller and its associated tasks to be **loaded into a composable node container**.

---

### Responsibilities

* Registers the Task Controller as a ROS 2 component
* Enables runtime composition via `rclcpp_components`
* Defines how the controller is instantiated within a container

---

### Key Concepts

* **Composable nodes**

  * Allows multiple nodes to run in the same process
* **Zero-copy communication**

  * Reduced overhead between controller and tasks
* **Deployment flexibility**

  * Enables container-based launch configurations

---

### Interactions

* Used by:

  * ROS 2 launch files (component containers)
* Registers:

  * `TaskControllerComponent`
* Does not implement logic

  * Purely structural / registration-based

---

### Role in System

This file is **infrastructure glue**.
It allows the task system to be deployed efficiently but contains no mission logic.

---

## Overall Architecture Summary

```
+-------------------------------+
| Task Controller Composition   |
| (component registration)      |
+---------------+---------------+
                |
                v
+-------------------------------+
| Task Controller Component     |
| - Task orchestration          |
| - Data routing                |
| - Task switching              |
+---------------+---------------+
                |
                v
+-------------------------------+
| Task Component (Base Class)   |
| - Lifecycle handling          |
| - Shared task logic           |
| - Waypoint generation         |
+---------------+---------------+
                |
                v
+-------------------------------+
| Specialized Task Components   |
| (maneuvering, speed, home…)   |
+-------------------------------+
```

---

## Design Intent

* **Separation of concerns**

  * Task logic ≠ task orchestration
* **Lifecycle safety**

  * Tasks can be cleanly started/stopped
* **Composable deployment**

  * Optimized for ROS 2 containers
* **Perception-driven autonomy**

  * Vision inputs directly influence navigation
---